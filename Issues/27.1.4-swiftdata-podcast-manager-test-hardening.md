# Issue 27.1.4: SwiftDataPodcastManager Test Hardening (Optional)

**Status**: ðŸ†• Proposed
**Priority**: P3 - Test Coverage Hardening
**Created**: 2026-01-17
**Category**: Testing / Reliability

## Description

Add optional, targeted tests for `SwiftDataPodcastManager` error handling and concurrency stress scenarios. The current unit suite covers happy paths and core edge cases, but does not simulate SwiftData save failures or concurrent access patterns.

## Acceptance Criteria

- [ ] Add a test-only hook or abstraction to simulate `ModelContext.save()` failures.
- [ ] Verify `add`, `update`, and `remove` handle save failures without crashing and do not trigger Siri snapshot refresh.
- [ ] Add a concurrency stress test that exercises concurrent calls into `SwiftDataPodcastManager` and confirms deterministic results.
- [ ] Update AppSmokeTests documentation to reflect the new coverage.

## Design Notes

### Save Failure Simulation

**Goal**: Exercise error paths without relying on SwiftData failures in production.

**Proposed Approach**:
1. Wrap `ModelContext.save()` behind a lightweight protocol or closure (e.g., `saveHandler: () throws -> Void`).
2. Provide a test-only initializer to inject a failing save handler.
3. Assert that failed saves do not trigger Siri refresh and do not mutate stored entities.

### Concurrency Stress Test

**Goal**: Validate serial queue correctness under concurrent access.

**Proposed Approach**:
1. Run concurrent `add`/`update`/`remove` calls from multiple queues.
2. Assert deterministic final state (expected count + expected fields).
3. Keep runtime bounded to avoid flakiness.

## Spec References

- N/A (test hardening for Issue 27.1 persistence implementation).

## Dependencies

- May require a small test-only abstraction or injection point in `SwiftDataPodcastManager`.

## Testing Strategy

- Extend `AppSmokeTests/SwiftDataPodcastManagerTests.swift` with explicit failure-path tests.
- Add a dedicated concurrency stress test (bounded runtime) using controlled queues.

## Notes

This issue is optional and intended to improve resilience coverage rather than enable a new feature.
