# Issue 27.1.7: Siri Snapshot Service Refactor

**Status**: Open
**Priority**: P2 - Medium
**Created**: 2026-01-17
**Category**: Architecture / Concurrency

## Description
Refactor Siri snapshot generation into a dedicated service that avoids circular dependencies, uses structured concurrency, and cleanly injects podcast fetching.

## Problem Statement
`SwiftDataPodcastManager` currently falls back to constructing a `SiriSnapshotCoordinator` when no refresher is injected. This couples persistence to snapshot generation and makes it harder to test or swap implementations.

## Acceptance Criteria
- [ ] Introduce a `SiriSnapshotService` (or equivalent) implementing `SiriSnapshotRefreshing`
- [ ] Service uses structured concurrency (no `Task.detached`)
- [ ] Podcast fetching injected via closure or protocol (no circular dependency)
- [ ] `SwiftDataPodcastManager` no longer constructs a coordinator internally
- [ ] `ZpodApp` wires the service explicitly for production
- [ ] Integration test updated to use the new service without regressions
- [ ] Full regression passes (`./scripts/run-xcode-tests.sh`)

## Spec References
- `zpod/spec/ui.md` (Siri/Shortcuts integration)
- `Issues/02.1.8.1-carplay-siri-data-wiring.md`

## Dependencies
- Related: Issue 27.1.2 (Siri snapshot verification)
- Related: Issue 30.1 (Swift 6 concurrency warnings)

## Testing Strategy
- Targeted: `./scripts/run-xcode-tests.sh -t IntegrationTests/PodcastPersistenceIntegrationTests/testSiriSnapshotReflectsPersistentData`
- Full regression: `./scripts/run-xcode-tests.sh`
