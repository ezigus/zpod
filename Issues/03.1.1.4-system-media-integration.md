# Issue 03.1.1.4: System Media Integration & Accessibility

**GitHub Issue**: [#111](https://github.com/ezigus/zpod/issues/111)

## Priority
Medium

## Status
✅ COMPLETE (Merged to main via PR #260)

## Description
Wire the core player experience into iOS system services so that playback controls work from Control Center, lock screen, and external accessories, while meeting baseline accessibility requirements. This task also ensures the player surfaces are fully accessible via VoiceOver and Dynamic Type.

## Acceptance Criteria
- Register `MPNowPlayingInfoCenter` metadata with artwork, title, podcast, and progress updates.
- Support remote command center actions (play/pause, skip forward/back) synchronized with in-app state.
- Configure `AVAudioSession` for background playback with correct category/options and handle interruptions (phone calls, Siri).
- Provide VoiceOver labels/hints for all player controls; Dynamic Type scaling verified for mini and expanded player layouts.
- Ensure haptic feedback is disabled when VoiceOver is active (per accessibility best practices).

## Execution Plan
1. **Design + alignment**
   - Re-read `spec/playback.md` and `spec/ui.md` for system media + accessibility expectations.
   - Document the integration flow and ownership in a new dev-log entry (diagram + responsibilities).
2. **Now Playing metadata**
   - Add a `NowPlayingInfoCoordinator` (or equivalent) that builds `MPNowPlayingInfoCenter` payloads from playback state.
   - Include title, podcast, artwork, duration, elapsed time, and playback rate updates.
3. **Remote command center**
   - Wire `MPRemoteCommandCenter` to playback service actions (play/pause/skip forward/back).
   - Respect configured skip intervals and update enabled/disabled state based on playback state.
4. **Audio session + interruptions**
   - Configure `AVAudioSession` for background playback and proper route options.
   - Observe interruption and route-change notifications; pause/resume appropriately.
5. **Accessibility + Dynamic Type**
   - Audit mini/expanded player controls for VoiceOver labels/hints and accessibility values.
   - Verify Dynamic Type sizing doesn’t truncate critical controls; adjust layout if needed.
   - Disable haptic feedback while VoiceOver is active (listen to `UIAccessibility.voiceOverStatusDidChangeNotification`).
6. **Tests + validation**
   - Unit tests for Now Playing payload builder and remote command handlers.
   - UI test assertions for accessibility labels (where feasible).
   - Manual verification: Control Center, lock screen, headset buttons; record in dev-log.

## Implementation Notes
- Add media remote handling via `MPRemoteCommandCenter` bridging into playback coordinator.
- Update audio session lifecycle in AppDelegate/SceneDelegate to respect background capabilities and interruptions.
- Audit SwiftUI views for accessibility modifiers (`.accessibilityLabel`, `.accessibilityAdjustableAction`) and Dynamic Type.

## Dependencies
- Builds on UI surfaces from Issues 03.1.1.1 and 03.1.1.2 and shared state from 03.1.1.3.
- Parent: [#107](https://github.com/ezigus/zpod/issues/107).

## Testing Strategy
- Manual validation with Control Center, lock screen, and headset controls (document results in dev log).
- Unit tests for media info payload builder and remote command handlers.
- UI tests with accessibility enabled (VoiceOver simulation where feasible) to verify labels.

## Deliverables
- System integration layer handling remote commands & metadata updates.
- Accessibility adjustments for mini and expanded player.
- Documentation updates describing background playback support.
