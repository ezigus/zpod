# Issue 28.1.10 - Swipe-to-Delete Download on Episode Rows

**Status:** Complete (2026-02-08)
**Priority:** Medium
**Category:** Download Management / UI
**Created:** 2026-02-07
**Parent Issue:** 28.1
**GitHub Issue:** [#395](https://github.com/ezigus/zpod/issues/395)

## Description

Add swipe-to-delete action on episode rows that removes the local download and reverts the episode to streaming-only. This enables users to free storage on a per-episode basis directly from the episode list.

## Problem Statement

**Current State**:
- Episodes can be downloaded but there is no swipe action to remove the download from the episode list
- Users have no per-episode download removal from the episode list view
- The only download deletion path is the bulk storage management screen

**Target State**:
- Swipe left on a downloaded episode row reveals a "Delete Download" action (`SwipeAction.deleteDownload`)
- Tapping the action shows a confirmation dialog (`DeleteDownload.Confirm` / `DeleteDownload.Cancel`)
- Confirming removes the local file via `DownloadManaging.deleteDownloadedEpisode(episodeId:)` and reverts download status to `.notDownloaded`
- The download badge disappears after deletion
- Non-downloaded episodes do not show the action

## Acceptance Criteria

- [x] New `SwipeActionType.deleteDownload` case added to `CoreModels/SwipeActionSettings.swift`
- [x] Swiping left on a downloaded episode row reveals a delete action with identifier `SwipeAction.deleteDownload`
- [x] The action only appears for episodes with effective download status `.downloaded` (model truth or env var seeded)
- [x] Tapping the action shows a confirmation dialog with buttons `DeleteDownload.Confirm` / `DeleteDownload.Cancel`
- [x] Confirming deletion calls `DownloadManaging.deleteDownloadedEpisode(episodeId:)` â†’ `DownloadCoordinatorBridge`
- [x] Episode `downloadStatus` reverts to `.notDownloaded`
- [x] Download badge disappears from the episode row (env var override skipped via `deletedDownloadEpisodeIDs`)
- [x] Non-downloaded episodes do not show the `SwipeAction.deleteDownload` swipe action
- [x] VoiceOver announces "Delete Download" as the swipe action label
- [x] `OfflinePlaybackUITests.testDeletedDownloadRevertsToStreaming` unskipped and passes

## Spec References

- `spec/offline-playback.md` - "Delete download reverts to streaming"
- `spec/download.md` - Per-episode download lifecycle

## Dependencies

- Issue 28.1.1 - Download Manager (provides `DownloadCoordinator`)
- Issue 28.1.2 - Local Storage and File Management (provides file deletion)

## Blocked Tests

Resolved in this issue:
- `OfflinePlaybackUITests.testDeletedDownloadRevertsToStreaming` is now unskipped and active.

## Testing Strategy

### Unit Tests
- Swipe action only appears for downloaded episodes
- Delete action triggers file removal
- Download status updates after deletion

### UI Tests
- `testDeletedDownloadRevertsToStreaming`

## Estimated Effort

Small-Medium (2-4 hours)

## Files Modified

| File | Changes |
|------|---------|
| `Packages/CoreModels/Sources/CoreModels/SwipeActionSettings.swift` | Add `.deleteDownload` case, update `downloadFocused` preset |
| `Packages/LibraryFeature/Sources/LibraryFeature/BatchOperationManager.swift` | Add `deleteDownloadedEpisode` to `DownloadManaging` protocol |
| `Packages/LibraryFeature/Sources/LibraryFeature/SwipeActionHandler.swift` | Add `deleteDownload` callback + switch case |
| `Packages/LibraryFeature/Sources/LibraryFeature/EpisodeListViewModel.swift` | Add confirmation state properties, wire callback |
| `Packages/LibraryFeature/Sources/LibraryFeature/EpisodeListViewModel+DownloadManagement.swift` | Add `deleteDownloadForEpisode()` method |
| `Packages/LibraryFeature/Sources/LibraryFeature/EpisodeListView.swift` | Conditional filtering, confirmation dialog, env var override fix |
| `zpodUITests/OfflinePlaybackUITests.swift` | Implement `testDeletedDownloadRevertsToStreaming` + non-downloaded assertion |
| `Packages/LibraryFeature/Tests/LibraryFeatureTests/EpisodeStatusProgressTests.swift` | Update `MockDownloadManager` |
