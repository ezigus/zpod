# Issue 28.1.9 - UI Test Hardening for Offline & Streaming Playback

**Status:** Open  
**Priority:** High  
**Category:** Testing / UI Automation  
**Created:** 2026-02-07  
**Parent Issue:** 28.1  
**GitHub Issue:** [#393](https://github.com/ezigus/zpod/issues/393)

## Description
Stabilize and unskip the offline/streaming UI suites by aligning accessibility identifiers, deterministic data seeding, and navigation/wait patterns with the shared testing guidelines. Focus is on `OfflinePlaybackUITests` and `StreamingInterruptionUITests` so they can run reliably in CI without manual intervention.

## Acceptance Criteria
- [ ] All tests in `OfflinePlaybackUITests` are active and pass locally and in CI.
- [ ] All non-hook-dependent tests in `StreamingInterruptionUITests` are active; hook-dependent cases skip gracefully when hooks are unavailable.
- [ ] Episode rows are discoverable via stable identifiers; download status indicators have unique row-level identifiers.
- [ ] Player surface is discoverable via stable identifiers even when launched from episode detail.
- [ ] Tests use shared page objects and wait helpers per `docs/testing` and `AGENTS.md`.
- [ ] TestSummary.md in `zpodUITests/` updated to reflect new coverage/gaps.

## Implementation Approach
1. Add/verify accessibility identifiers for download status, player, and network/buffer debug hooks.
2. Ensure UITEST_* environment seeding covers downloaded episodes and network/buffer simulation.
3. Update UI tests to use page objects, `waitUntil` helpers, and materialize list rows before assertions.
4. Replace brittle badge queries with row-scoped identifiers; add deterministic navigation to Player tab fallback.
5. Run targeted suites (`./scripts/run-xcode-tests.sh -t zpodUITests/OfflinePlaybackUITests,zpodUITests/StreamingInterruptionUITests`) and fix flakiness.
6. Document results and remaining skips in TestSummary.md.

## Specification References
- `spec/offline-playback.md`
- `spec/streaming-playback.md`
- `docs/testing/UI_TESTING_ADVANCED_PATTERNS.md`
- `docs/testing/ACCESSIBILITY_TESTING_BEST_PRACTICES.md`

## Dependencies
- Issue 28.1.6 - UI Integration: Download/Streaming Indicators (identifiers)
- Issue 28.1.4 - Network Monitoring & Adaptation (test hooks availability)
- Issue 28.1.7 - Test Infrastructure for Offline/Streaming Modes

## Estimated Effort
Medium (1â€“2 days)

## Success Metrics
- Targeted suites pass locally and in CI.
- Flake rate for these suites <1% across 5 CI runs.

## Testing Strategy
- Targeted UI runs for the two suites after each change.
- Optional smoke: `./scripts/run-xcode-tests.sh -t zpodUITests` once green.
- Record outcomes in `TestResults` artifacts and TestSummary.md. 
