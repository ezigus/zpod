# 02.6.3.3 - Enforce 5-Minute Runtime Budget for Swipe Test Suites

## Description

Add runtime guardrails to SwipeConfiguration test suites to enforce a 5-minute budget per suite, preventing performance regressions and ensuring CI efficiency.

## Problem Statement

1. **No runtime enforcement**: Tests can gradually become slower without triggering failures
2. **Performance regression risk**: Future changes might add expensive operations without notice
3. **CI inefficiency**: Slow tests delay feedback and consume CI minutes
4. **Budget creep**: Without guardrails, "just one more assertion" compounds over time

## Proposed Solution

Implement runtime budgets using XCTest's built-in measurement APIs:

**Approach 1: XCTestCase Metrics (Recommended)**
```swift
final class SwipeConfigurationUIDisplayTests: SwipeConfigurationTestCase {
  override func setUp() {
    super.setUp()
    // Enforce 5-minute (300s) budget for entire suite
    let budgetMetric = XCTClockMetric()
    measure(metrics: [budgetMetric]) {
      // Suite execution
    }
  }
}
```

**Approach 2: Custom Timing Assertions**
```swift
final class SwipeConfigurationUIDisplayTests: SwipeConfigurationTestCase {
  static var suiteStartTime: Date?

  override class func setUp() {
    super.setUp()
    suiteStartTime = Date()
  }

  override class func tearDown() {
    let elapsed = Date().timeIntervalSince(suiteStartTime!)
    XCTAssertLessThan(elapsed, 300, "Suite exceeded 5-minute budget")
    super.tearDown()
  }
}
```

**Recommended**: Approach 2 for simplicity and clear failure messages.

## Acceptance Criteria

- [ ] All 6 SwipeConfiguration test suites enforce 5-minute runtime budget
- [ ] Tests fail with clear message when budget exceeded
- [ ] Budget enforcement runs in CI (not just local)
- [ ] Budgets configurable per suite if needed (e.g., 3 min for simple suites, 5 min for complex)
- [ ] Documentation updated with budget rationale and override instructions
- [ ] CI logs show actual runtime vs budget for each suite

## Implementation Details

**Per-Suite Budgets**:
| Suite | Current Runtime | Budget | Headroom |
|-------|----------------|--------|----------|
| SwipeConfigurationUIDisplayTests | ~45s | 3 min | 2m 15s |
| SwipePresetSelectionTests | ~40s | 3 min | 2m 20s |
| SwipeToggleInteractionTests | ~3m 15s | 5 min | 1m 45s |
| SwipeActionManagementTests | ~2m | 3 min | 1m |
| SwipePersistenceTests | ~2m 30s | 5 min | 2m 30s |
| SwipeExecutionTests | ~3m | 5 min | 2m |

**Configuration**:
```swift
// SwipeConfigurationTestCase.swift
extension SwipeConfigurationTestCase {
  var suiteBudget: TimeInterval {
    // Override in subclasses for custom budgets
    return 300 // 5 minutes default
  }
}
```

## Benefits

- **Prevents performance regression**: Slow changes fail immediately
- **Clear expectations**: Developers know runtime limits upfront
- **CI efficiency**: Ensures test suites don't consume excessive CI time
- **Early warning**: Budget violations surface before merge, not in production CI

## Edge Cases

**Handling CI Slowness**:
- Budgets should account for CI environment (typically 1.5-2x slower than local)
- Consider separate budgets for local vs CI, or use `ProcessInfo.processInfo.environment["CI"]`

**Debug Builds**:
- Debug builds may be slower; budgets should be reasonable for both debug and release

**Flaky Timing**:
- Budgets should have reasonable headroom (e.g., 2x current runtime) to avoid false failures

## References

- Parent Issue: #131 (SwipeConfiguration UI Test Decomposition)
- Related: `zpodUITests/SwipeConfigurationTestSupport.swift` (base test case)
- XCTest Documentation: [XCTMetric](https://developer.apple.com/documentation/xctest/xctmetric)
- Dev Log: `dev-log/02.6.3-swipe-configuration-test-decomposition.md`
