# Issue 02.1.3.1: Multi-Selection and Batch Interface Enhancements

## Priority
Medium

## Status
✅ Completed (Addressed via PR #54)

## Description
Deliver the UI/UX foundation for batch managing episodes on iPhone: multi-select entry, selection toolbar controls, batch action menus, and the underlying operation queue plumbing with cancel/retry/undo hooks. This covers the Phase 1 work originally tracked under Issue 02.1.3.

## Acceptance Criteria

### Scenario 1: Entering Multi-select Mode
- **Given** I am browsing an episode list
- **When** I tap the `Select` button or long-press an episode
- **Then** the list transitions into multi-select mode with checkmarks and highlighted selections
- **And** a selection toolbar appears showing counts and bulk action controls

### Scenario 2: Performing Batch Actions
- **Given** I have selected multiple episodes
- **When** I invoke a batch action (Download, Mark as Played/Unplayed, Favorite, Add to Playlist, Delete, Archive, Share)
- **Then** the batch operation manager enqueues the request, exposes progress in `BatchOperationProgressView`, and supports cancel/retry flows where appropriate

### Scenario 3: Selection Utilities
- **Given** I am in multi-select mode
- **When** I tap `All`, `None`, or `Invert`
- **Then** the selection state updates accordingly and remains stable during scrolling or filtering changes

### Scenario 4: Criteria-based Selection
- **Given** I open the `Criteria` sheet
- **When** I choose filters such as play status, download status, age, or favorites
- **Then** the matching episodes become selected and the selection toolbar reflects the new count

## Implementation Summary
- Added multi-select toolbar with selection helpers and a criteria sheet (`EpisodeListView.swift`)
- Extended `EpisodeListViewModel` with selection state, batch execution helpers, undo/retry scaffolding, and filter persistence hooks
- Implemented `BatchOperationManager` progress pipeline, cancellation, and mock undo/retry pathways
- Refined `BatchOperationViews` with progress indicators, cancel, retry, and undo affordances
- Augmented unit coverage in `BatchOperationTests` for selection state, criteria matching, progress tracking, and undo/retry logic

## Specification References
- `ui.md` – Multi-selection interface conventions
- `content.md` – Bulk episode operations scenarios

## Dependencies
- **Required**: Issue 02.1.2 – Episode Sorting & Filtering (filter services used by selection helpers)
- **Recommended**: Issue 06.1.1 – Playlist Management (enhances Add-to-Playlist experience, not a blocker)

## Success Metrics
- Entering or exiting multi-select takes < 150 ms
- Batch operations update progress indicators within 200 ms of state change
- Selection toolbar accurately reflects counts under filtering or paging

## Testing
- Unit: `BatchOperationTests` exercising selection state, criteria matching, undo/retry, and progress calculations
- UI: `BatchOperationUITests` validating toolbar entry, selection toggles, and batch progress presentation
- Concurrency: `dev-build-enhanced.sh concurrency` ensures actor isolation and task helpers remain Swift 6 compliant
