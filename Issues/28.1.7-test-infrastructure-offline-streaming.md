# Issue 28.1.7 - Test Infrastructure for Offline and Streaming Modes

**Status:** Open  
**Priority:** High  
**Category:** Testing / Infrastructure  
**Created:** 2026-01-14  
**Parent Issue:** 28.1  
**GitHub Issue:** [#343](https://github.com/ezigus/zpod/issues/343)

## Description
Add deterministic test infrastructure for offline (file://) and streaming (https://) playback modes, including fixtures, mocks, and CI-safe UI tests that map to offline/streaming specs.

## Acceptance Criteria
- [ ] Test helpers can produce local-file episodes and streaming episodes with deterministic URLs.
- [ ] Mock FileManagerServicing supports file-exists and download-path behavior.
- [ ] Network monitor stub can simulate online/offline transitions.
- [ ] Integration tests validate source selection and playback for both modes.
- [ ] UI tests verify download -> offline playback flow and streaming indicator flow.
- [ ] TestSummary.md files updated with new coverage.

## Implementation Approach
1. Design: add dev-log entry outlining fixtures, mocks, and coverage mapping.
2. Add TestSupport helpers for local file fixtures and streaming URLs.
3. Add mocks for FileManagerServicing and network monitor.
4. Add integration tests around UnifiedPlaybackCoordinator.
5. Add UI tests for offline playback and streaming indicators.
6. Document coverage in TestSummary.md files.

## Specification References
- `zpod/spec/offline-playback.md`
- `zpod/spec/streaming-playback.md`
- `zpod/spec/playback.md`

## Dependencies
- Issue 28.1.5 - Unified Playback Coordinator
- Issue 28.1.6 - UI Integration: Download/Streaming Indicators
- Issue 28.1.1 - Download Manager Implementation
- Issue 28.1.2 - Local Storage and File Management

## Estimated Effort
Medium (2-3 days)

## Success Metrics
- Deterministic tests with no network flakiness.
- CI pass rate >= 99% for new suites.

## Testing Strategy
- Unit tests for mocks and helpers.
- Integration tests for playback source switching.
- UI tests for offline and streaming states.
