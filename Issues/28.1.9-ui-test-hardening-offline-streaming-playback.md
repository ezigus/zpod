# Issue 28.1.9 - UI Test Hardening for Offline & Streaming Playback

**Status:** Open  
**Priority:** High  
**Category:** Testing / UI Automation  
**Created:** 2026-02-07  
**Parent Issue:** 28.1  
**GitHub Issue:** [#393](https://github.com/ezigus/zpod/issues/393)

## Description

Stabilize the offline/streaming UI suites by aligning accessibility identifiers, deterministic data seeding, and navigation/wait patterns with the shared testing guidelines. Focus is on `OfflinePlaybackUITests` and `StreamingInterruptionUITests` so unblocked scenarios run reliably in CI without manual intervention.

## Scope Boundary (No Overlap)

`28.1.9` is **test hardening only**. The following implementation work is intentionally out of scope:

- [#395](https://github.com/ezigus/zpod/issues/395) / Issue `28.1.10`: swipe delete download behavior (`SwipeAction.delete`)
- [#396](https://github.com/ezigus/zpod/issues/396) / Issue `28.1.11`: network/buffer simulation hook integration (**resolved; retained for traceability**)
- [#269](https://github.com/ezigus/zpod/issues/269) / Issue `03.3.4`: `PlaybackError` accessibility/error surface

## Acceptance Criteria

- [ ] **Offline suite hardening:** all `OfflinePlaybackUITests` scenarios that are not blocked by `#395` or `#269` are active and pass locally and in CI; blocked scenarios skip with explicit issue-traceable `XCTSkip` reasons.
- [ ] **Streaming suite hardening:** all `StreamingInterruptionUITests` scenarios that are not blocked by `#269` are active and pass locally and in CI; blocked scenarios skip gracefully with explicit issue-traceable `XCTSkip` reasons.
- [ ] Episode rows are discoverable via stable identifiers; any rendered download-status indicator uses a unique row-scoped identifier.
- [ ] Player surface is discoverable via stable identifiers from the hardened test navigation paths (including episode-detail navigation used by these suites).
- [ ] Tests use shared page objects and wait helpers per `docs/testing` and `AGENTS.md` (no fixed sleeps in hardened paths).
- [ ] `zpodUITests/TestSummary.md` is updated to reflect coverage, blockers, and remaining gaps.

## Implementation Approach

1. Add/verify accessibility identifiers for download status and player discoverability markers.
2. Ensure `UITEST_*` environment seeding supports deterministic downloaded-episode matching per row.
3. Update UI tests to use page objects, wait helpers, and robust identifier/label fallback where SwiftUI wrappers require it.
4. Ensure blocked scenarios skip with issue references (`#395`, `#269`) instead of hard failures.
5. Run targeted suites:  
   `./scripts/run-xcode-tests.sh -t zpodUITests/OfflinePlaybackUITests,zpodUITests/StreamingInterruptionUITests`
6. Document outcomes and blockers in `zpodUITests/TestSummary.md` and `dev-log/28.1.9-ui-test-hardening.md`.

## Specification References

- `zpod/spec/offline-playback.md`
- `zpod/spec/streaming-playback.md`
- `docs/testing/UI_TESTING_ADVANCED_PATTERNS.md`
- `docs/testing/ACCESSIBILITY_TESTING_BEST_PRACTICES.md`

## Dependencies

- Issue `28.1.6` - UI integration download/streaming indicators (identifier support)
- Issue `28.1.7` - test infrastructure for offline/streaming modes
- Blocked feature dependencies tracked externally: `#395`, `#269`

## Testing Strategy

- Run targeted UI suites after each change:
  - `./scripts/run-xcode-tests.sh -t zpodUITests/OfflinePlaybackUITests`
  - `./scripts/run-xcode-tests.sh -t zpodUITests/StreamingInterruptionUITests`
- Run combined targeted suite for closure evidence:
  - `./scripts/run-xcode-tests.sh -t zpodUITests/OfflinePlaybackUITests,zpodUITests/StreamingInterruptionUITests`
- Record logs in `TestResults/` and keep `zpodUITests/TestSummary.md` current with blocker mapping.
