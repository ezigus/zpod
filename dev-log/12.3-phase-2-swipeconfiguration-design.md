# Phase 2 Design — SwipeConfigurationTestCase Migration

**Issue**: #12.3 — UI Test Infrastructure Cleanup  
**Created**: 2026-01-18 (Phase 2 kickoff)  
**Goal**: Migrate the swipe configuration suite’s base class to `IsolatedUITestCase`, ensure its sequencing uses the new page objects, and document the verification chronicle before writing any production code.

## Intent & Constraints

- Deliver automatic cleanup, launch guarantees, and navigation helpers already validated in Phase 1.
- Preserve swipe-specific wiring (seeded defaults, readiness caching, debug overlay) while removing duplicate cleanup.
- Keep tests stable during the transition to the new base by explicitly setting `userDefaultsSuite` and any other swipe-scoped isolation hooks.
- Confirm the suite still passes in CI after the migration (`./scripts/run-xcode-tests.sh -t Swipe*` is the target validation command).

## Scope of Work

1. Update `SwipeConfigurationTestCase.swift` to inherit `IsolatedUITestCase`.
2. Remove manual `setUpWithError()`/`tearDownWithError()` overrides that now exist in the base.
3. Override `userDefaultsSuite` to return `swipeDefaultsSuite` (or `nil` if already handled elsewhere).
4. Audit helper files (`SwipeConfigurationTestSupport+*.swift`) to ensure they either stay `@MainActor` or mark delegation as `nonisolated` if they need to call the new base’s helpers.
5. Keep swipe-specific utilities (debug overlay, readiness caching) intact by refactoring them into `SwipeConfigurationTestSupport` so they can coexist with the new base.
6. Run `./scripts/run-xcode-tests.sh -t Swipe*` to confirm the swipe suites pass and no regressions appear.

## Risks & Mitigation

- **Risk**: `IsolatedUITestCase` enforces `MainActor` constraints that existing swipe helpers may not satisfy.  
  **Mitigation**: Identify any `nonisolated` helpers used by the swipe suite and either mark them `nonisolated` or refactor them so calls happen inside `MainActor.assumeIsolated`.
- **Risk**: Swipe suite still relies on legacy wait helpers (e.g., `waitForAnyElement`).  
  **Mitigation**: Reuse the unified wait API introduced in Phase 1 when touching these files; minimize direct UI queries by using the new page objects where possible.

## Design Diagram (Mermaid)

```mermaid
flowchart TD
  subgraph New Infrastructure
    ISO(IsolatedUITestCase)
    TAB(TabBarNavigation)
    SET(SettingsScreen)
  end
  subgraph Swipe Suite
    SWC(SwipeConfigurationTestCase)
    SUPPORT(SwipeConfigurationTestSupport)
  end
  ISO --> SWC
  SUPPORT --> SWC
  SWC --> TAB
  TAB --> SET
  SET -->|site-specific waits| ISO
  note right of SWC: Phase 2 migration logic
```

## Next Steps

1. Update `SwipeConfigurationTestCase.swift` as described above.
2. Capture any new `@MainActor` assumptions in the base and helpers.
3. Execute `./scripts/run-xcode-tests.sh -t Swipe*` locally once the refactor compiles.
4. Document results in this dev-log entry and update the main migration plan if any scope changes occur.
