# Issue 02.5 – Testing Cleanup | Dev Log

## 2025-10-08 – Cross-Platform Theming Audit (Started 09:20 ET)
- Context: Reviewing PR for Issue 02.5 to ensure feature packages run on macOS runners.
- Finding: SwiftUI surfaces promoted to macOS still relied on `Color(.systemGrayX)` UIKit initializers, which fail to compile on macOS targets now that manifests include `.macOS(.v14)`.
- Decision: Introduce shared color shims in `SharedUtilities` (`Color.platformSystemGray{4,5,6}`) and refactor feature views/tests to consume them.
- Next Steps: Update affected files to import `SharedUtilities`, run package + regression scripts to confirm macOS builds succeed, and verify PR alignment with acceptance criteria.

## 2025-11-03 – Mac Catalyst Audit & Remediation (11:20 ET)
- Added platform-aware gray palette helpers in `SharedUtilities` and replaced `Color(.systemGrayX)` usages across Discover, Library, and Player features.
- Updated mini-player tests to import Foundation, await annotation loads, and guarded iOS-only SwiftUI modifiers (e.g., `navigationBarTitleDisplayMode`, `keyboardType`) for macOS compatibility.
- Extended `EpisodeDetailViewModel.loadEpisode` to return a cancellable `Task` so tests can await transcript hydration; adjusted tests accordingly.
- Verified packages on macOS builders via `./scripts/run-xcode-tests.sh -t PlayerFeature`, `-t LibraryFeature`, and `-t DiscoverFeature`.

## 2025-11-03 – Preflight Follow-up (12:10 ET)
- Addressed CI preflight failure: CarPlay/Discover view now uses platform-safe toolbars, RSS validation checks for scheme, and Discover tests run under `@MainActor`.
- Introduced `View+PlatformModifiers` and `PlatformToolbarPlacement` in `SharedUtilities` to centralize navigation/list styling fallbacks for macOS.
- LibraryFeature builds on macOS after replacing iOS-only modifiers, adding placeholder selection views, and gating keyboard-specific modifiers. Pending work: update LibraryFeature tests (`SettingsFeatureRouteFactoryTests`, `EpisodeStatusProgressTests`) for actor isolation and immutable structs; `swift test --package-path Packages/LibraryFeature` currently fails on those test shims.

- Adjusted LibraryFeature test target to compile on macOS by wrapping iOS-only suites in `#if os(iOS)`; `swift test --package-path Packages/LibraryFeature` now succeeds (0 tests executed on mac) followed by `./scripts/run-xcode-tests.sh -t LibraryFeature` to verify.
