# Phase 5 Design — Remaining Test Suite Migrations

**Issue**: #12.3 — UI Test Infrastructure Cleanup
**Created**: 2026-01-20 (Phase 5 kickoff)
**Goal**: Complete the migration of all remaining UI test suites to `IsolatedUITestCase`, achieving 100% coverage of the migration plan.

## Intent & Constraints

- Phase 5 represents the final cleanup phase, migrating the remaining standalone test suites that haven't yet inherited from `IsolatedUITestCase`.
- These tests are lower complexity (mostly simple inheritance updates) compared to earlier phases.
- Leverage all infrastructure from Phases 1-4: `IsolatedUITestCase`, page objects (`TabBarNavigation`, `PlayerScreen`, etc.), and shared helpers.
- Swipe tests already use `SwipeConfigurationTestCase` (which inherits `IsolatedUITestCase` as of Phase 2), so they only need verification, not migration.

## Scope of Work

### Test Suites to Migrate

Based on the migration plan and current state:

**Player-related tests (3 files):**
1. `PlayerPlaybackInteractionTests.swift` - Simple playback interaction tests
2. `PlayerAccessibilityTests.swift` - VoiceOver and accessibility validation
3. `MiniPlayerPersistenceTests.swift` - Mini player state persistence

**Feature tests (2 files):**
4. `BatchOperationUITests.swift` - Batch download/archive operations
5. `EpisodeListUITests.swift` - Episode list display and scrolling

**Snapshot tests (1 file):**
6. `PlayerOrientationSnapshotTests.swift` - Player orientation snapshot validation

**Swipe tests (6 files - verification only):**
- `SwipeActionManagementTests.swift`
- `SwipeConfigurationUIDisplayTests.swift`
- `SwipeExecutionTests.swift`
- `SwipePersistenceTests.swift`
- `SwipePresetSelectionTests.swift`
- `SwipeToggleInteractionTests.swift`

### Migration Strategy

#### For Player/Feature/Snapshot Tests (6 files):

1. Update class declaration to inherit from `IsolatedUITestCase`
2. Remove manual `setUpWithError()` / `tearDownWithError()` if they only do cleanup
3. Keep test-specific setup (e.g., seeding data, configuring launch environment)
4. Replace `initializeApp()` with `app = launchConfiguredApp()` where applicable
5. Use page objects (`TabBarNavigation`, `PlayerScreen`) instead of ad-hoc element queries
6. Verify tests pass with full isolation

#### For Swipe Tests (6 files - verification only):

1. Confirm they inherit from `SwipeConfigurationTestCase` (which inherits `IsolatedUITestCase`)
2. Run targeted tests to verify isolation works correctly
3. No code changes needed unless issues found

## Risks & Mitigation

- **Snapshot test compatibility**: `PlayerOrientationSnapshotTests` may need special handling if it relies on specific simulator state; ensure snapshots remain consistent after migration.
- **Batch operation timing**: `BatchOperationUITests` may have timing-sensitive assertions; reuse shared wait helpers (`waitForContentToLoad`, `waitForAny`) to avoid flakiness.
- **Swipe test suite size**: 6 swipe tests to verify; batch verification using `./scripts/run-xcode-tests.sh -t Swipe*` for efficiency.

## Verification

After implementation, run targeted verification:

```bash
# Player tests
./scripts/run-xcode-tests.sh -t PlayerPlaybackInteractionTests,PlayerAccessibilityTests,MiniPlayerPersistenceTests

# Feature tests
./scripts/run-xcode-tests.sh -t BatchOperationUITests,EpisodeListUITests

# Snapshot tests
./scripts/run-xcode-tests.sh -t PlayerOrientationSnapshotTests

# Swipe tests (verification)
./scripts/run-xcode-tests.sh -t Swipe*

# Full regression
./scripts/run-xcode-tests.sh
```

## Success Criteria

- ✅ All 6 migrated test files inherit from `IsolatedUITestCase`
- ✅ All 6 swipe test files verified to work with inherited isolation
- ✅ 100% test pass rate (no regressions)
- ✅ Full regression passes
- ✅ Migration plan complete (all phases 1-5 done)

## Next Steps

1. Migrate the 6 test files (player, feature, snapshot)
2. Verify the 6 swipe test files work correctly
3. Run full verification suite (targeted + full regression)
4. Update `dev-log/` with implementation log
5. Ensure `AGENTS.md` references this Phase 5 design note
6. Create PR and merge to main

## Implementation Log

*To be updated as work progresses*
