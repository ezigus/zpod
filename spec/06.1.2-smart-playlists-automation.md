# Spec: 06.1.2 Smart Playlists and Automation

## Overview

Smart playlists are dynamically evaluated episode lists that automatically match episodes against user-defined criteria. Unlike manual playlists, smart playlists do not store episode IDs — they store *rules* and re-evaluate on every access.

The implementation builds on the existing `SmartEpisodeListV2` engine (13 rule types, AND/OR with negation, relative dates, templates, and a working evaluation engine).

---

## Scenario 1: Create a Custom Smart Playlist

**Given** I am on the Playlists screen
**When** I tap "+" and select "New Smart Playlist"
**Then** a creation form opens with fields for name, description, rules, sort order, episode limit, and automation settings
**And** I can add multiple rules with type/comparison/value pickers
**And** I can toggle AND/OR logic between rules
**And** I can toggle rule negation (NOT)
**And** a live preview section shows how many episodes match the current rules

---

## Scenario 2: Edit an Existing Custom Smart Playlist

**Given** I have a custom smart playlist "My Unplayed"
**When** I navigate to its detail view and tap "Edit"
**Then** the creation form opens pre-populated with the existing name, rules, sort order, and settings
**And** I can modify any field and tap "Save" to persist the changes
**And** the detail view refreshes to reflect updated evaluation results

---

## Scenario 3: Delete a Custom Smart Playlist

**Given** I have custom smart playlists in the "My Smart Playlists" section
**When** I swipe-to-delete or use the context menu
**Then** the smart playlist is removed from the list
**And** built-in (system-generated) smart playlists cannot be deleted

---

## Scenario 4: Built-in Smart Playlists

**Given** I open the Playlists screen for the first time
**Then** I see a "Smart Playlists" section with 6 built-in smart lists:
  - Recent Unplayed
  - Downloaded Episodes
  - Short Episodes (< 15 min)
  - Long Episodes (> 45 min)
  - Recently Added
  - Played This Week
**And** these lists cannot be deleted or edited
**And** each list shows the current episode count

---

## Scenario 5: Smart Playlist Detail View

**Given** I tap on any smart playlist (built-in or custom)
**When** the detail view opens
**Then** I see dynamically evaluated episodes matching the playlist's rules
**And** I see "Play All" and "Shuffle" buttons
**And** I see a "Rules" section summarizing the active rules, sort order, and limits
**And** if no episodes match, an empty state explains the situation

---

## Scenario 6: Duplicate a Custom Smart Playlist

**Given** I have a custom smart playlist "My List"
**When** I use the context menu and tap "Duplicate"
**Then** a new smart playlist "My List Copy" is created with the same rules and settings
**And** the copy has a distinct ID and can be edited independently
**And** built-in smart playlists cannot be duplicated

---

## Scenario 7: Create from Template

**Given** I am on the Playlists screen
**When** I tap "+" and select "From Template"
**Then** I see templates organized by category (Recent, Duration, Status, Downloads)
**And** selecting a template creates a new custom smart playlist with pre-configured rules

---

## Scenario 8: Automation — Auto-Update

**Given** I create a smart playlist with "Auto-update" enabled
**When** new episodes arrive that match the rules
**Then** the smart playlist's evaluated results include the new episodes automatically
**And** I can configure the refresh interval (1 min, 5 min, 15 min, 30 min, 1 hour)

---

## Scenario 9: Rule Types and Comparisons

**Given** I am adding rules to a smart playlist
**Then** I can use any of these 13 rule types:
  - Play Status (unplayed, played, in-progress)
  - Download Status (downloaded, not downloaded, downloading, failed, queued)
  - Date Added (relative: today, last 3 days, last 7 days, last 30 days, last 90 days)
  - Publication Date (same relative periods)
  - Duration (in minutes, with greater/less than comparisons)
  - Rating (1-5 stars)
  - Podcast (title text matching)
  - Episode Title (text matching)
  - Description (text matching)
  - Is Favorited (boolean)
  - Is Bookmarked (boolean)
  - Is Archived (boolean)
  - Playback Position (progress percentage)
**And** each rule type supports appropriate comparisons (equals, not equals, contains, greater than, less than, etc.)

---

## Scenario 10: Playback from Smart Playlist

**Given** I am viewing a smart playlist detail with matching episodes
**When** I tap "Play All"
**Then** the `onPlayAll` callback fires with the evaluated episode list
**When** I tap "Shuffle"
**Then** the `onShuffle` callback fires with the evaluated episode list

---

## Test Coverage Mapping

| Scenario | Test File | Test Count |
|----------|-----------|------------|
| 1 (Create) | SmartPlaylistViewModelTests | 4 tests |
| 2 (Edit/Update) | SmartPlaylistViewModelTests | 2 tests |
| 3 (Delete) | SmartPlaylistViewModelTests + SmartPlaylistManagingTests | 4 tests |
| 4 (Built-in) | SmartPlaylistViewModelTests + SmartPlaylistManagingTests | 5 tests |
| 5 (Detail/Evaluation) | SmartPlaylistViewModelTests | 5 tests |
| 6 (Duplicate) | SmartPlaylistViewModelTests | 2 tests |
| 7 (Templates) | SmartPlaylistViewModelTests | 2 tests |
| 8 (Automation) | SmartPlaylistViewModelTests | 1 test (create with options) |
| 9 (Rule Types) | SmartPlaylistManagingTests (evaluation) | 2 tests |
| 10 (Playback) | SmartPlaylistViewModelTests | 2 tests |
| Builder Methods | SmartPlaylistManagingTests | 9 tests |
| **Total** | | **48 tests** |
